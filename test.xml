<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'>

<nta>
<declaration>
// Place global declarations here.
const int N = 7; //amount of voters
const int candidates = 2; //amount of candidates

typedef int[0, N-1] voter_id;

int lastcoercedvoterid, coercion_report; //coercion report data relay
int lastvoterid, voters_vote;
int coercion;
int tracker_id;
int tracker_request, tracker_out, tracker_val;

chan ballot; //voter activation
chan vote, vote_end, tracker_dist_end; //voting process status notification
chan notify_auth; //coercion notification
chan coerce[N], requesttracker[N]; //coercion
chan tracker[N], faketracker[N]; //tracker distribution
chan tracker_create, tracker_get; //tracker management
chan punish[N], leavebe[N];
</declaration>
<template>
<name>Voter</name>
<parameter>const voter_id me</parameter>
<declaration>
//Actions START
const bool say_truth = true;
const bool say_lie = true;
const bool notify_authority = true;
const bool keep_silent = true;
//Actions STOP

// Place local declarations here.
bool coerced = false;
bool silent = false;
int i;
int mycoercion = -1;
int mycandidate = -1;
int trackerid = -1;
int faketrackerid = -1;

void notify_coercion(){
	lastcoercedvoterid = me;
	coercion_report = mycoercion;
}

void placeVote(){
	lastvoterid = me;
	mycandidate = i;
	voters_vote = mycandidate;
}</declaration>
<location id="id0" x="112" y="-112">
<name x="128" y="-128">received_ballot_coerced</name>
</location>
<location id="id1" x="240" y="432">
<name x="256" y="416">not_punished</name>
</location>
<location id="id2" x="80" y="432">
<name x="0" y="416">punished</name>
</location>
<location id="id3" x="160" y="336">
<name x="176" y="320">awaiting_coercer_reaction</name>
</location>
<location id="id4" x="112" y="-280">
<name x="102" y="-310">coerced_start</name>
</location>
<location id="id5" x="160" y="144">
<name x="176" y="128">received_fake_tracker</name>
</location>
<location id="id6" x="-96" y="144">
<name x="-216" y="136">received_tracker</name>
</location>
<location id="id7" x="112" y="48">
<name x="128" y="40">notified_auth_of_coertion</name>
</location>
<location id="id8" x="-96" y="48">
<name x="-152" y="32">voted</name>
</location>
<location id="id9" x="-96" y="-112">
<name x="-208" y="-120">received_ballot</name>
</location>
<location id="id10" x="-96" y="-280">
<name x="-112" y="-312">start</name>
</location>
<init ref="id10"/>
<transition>
<source ref="id3"/>
<target ref="id1"/>
<label kind="synchronisation" x="208" y="368">leavebe[me]?</label>
</transition>
<transition>
<source ref="id3"/>
<target ref="id2"/>
<label kind="synchronisation" x="32" y="368">punish[me]?</label>
</transition>
<transition>
<source ref="id5"/>
<target ref="id3"/>
<label kind="guard" x="200" y="232">say_lie</label>
<label kind="synchronisation" x="200" y="248">requesttracker[me]?</label>
<label kind="assignment" x="200" y="264">tracker_id = faketrackerid</label>
<nail x="192" y="192"/>
<nail x="192" y="192"/>
</transition>
<transition>
<source ref="id4"/>
<target ref="id0"/>
<label kind="synchronisation" x="120" y="-208">ballot?</label>
<label kind="assignment" x="120" y="-192">coerced = true</label>
</transition>
<transition>
<source ref="id7"/>
<target ref="id8"/>
<label kind="select" x="-16" y="-8">i: int[0, candidates-1]</label>
<label kind="synchronisation" x="-16" y="8">vote!</label>
<label kind="assignment" x="-16" y="24">placeVote()</label>
</transition>
<transition>
<source ref="id0"/>
<target ref="id7"/>
<label kind="guard" x="120" y="-64">notify_authority</label>
<label kind="synchronisation" x="120" y="-48">notify_auth!</label>
<label kind="assignment" x="120" y="-32">notify_coercion()</label>
</transition>
<transition>
<source ref="id6"/>
<target ref="id5"/>
<label kind="guard" x="-72" y="88">coerced==true &amp;&amp; silent == false</label>
<label kind="synchronisation" x="24" y="104">faketracker[me]?</label>
<label kind="assignment" x="-40" y="120">faketrackerid = tracker_out</label>
</transition>
<transition>
<source ref="id8"/>
<target ref="id6"/>
<label kind="synchronisation" x="-184" y="64">tracker[me]?</label>
<label kind="assignment" x="-248" y="80">trackerid = tracker_out</label>
</transition>
<transition>
<source ref="id9"/>
<target ref="id8"/>
<label kind="select" x="-224" y="-80">i: int[0, candidates-1]</label>
<label kind="synchronisation" x="-128" y="-48">vote!</label>
<label kind="assignment" x="-168" y="-32">placeVote()</label>
</transition>
<transition>
<source ref="id10"/>
<target ref="id9"/>
<label kind="synchronisation" x="-136" y="-208">ballot?</label>
</transition>
<transition>
<source ref="id10"/>
<target ref="id4"/>
<label kind="synchronisation" x="-72" y="-320">coerce[me]?</label>
<label kind="assignment" x="-72" y="-304">mycoercion = coercion</label>
</transition>
</template>
<system>
// Place template instantiations here.

// List one or more processes to be composed into a system.
system Authority, Defense_System, Bulletin_Board, Coercer, Voter;
</system>
</nta>